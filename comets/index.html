<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Welcome to COMETS (COnsortium of METabolomics Studies)</title>
    <!--<link rel="stylesheet" href="https://cdn.datatables.net/1.10.10/css/jquery.dataTables.min.css" />-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.34.7/css/bootstrap-dialog.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/colreorder/1.3.2/css/colReorder.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.2.2/css/buttons.dataTables.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.1/css/selectize.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.1/css/selectize.bootstrap3.min.css" />
    <link rel="stylesheet" href="/common/css/style.css" />
    <link rel="stylesheet" href="public/css/common.css" />
    <link rel="stylesheet" href="public/css/comets.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.1/js/standalone/selectize.min.js" type="text/javascript"></script>
    <script src="https://cdn.datatables.net/1.10.10/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/colreorder/1.3.2/js/dataTables.colReorder.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.12/js/dataTables.bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.34.7/js/bootstrap-dialog.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="javascript/appViews.js"></script>
    <script type="text/javascript" src="javascript/appModels.js"></script>
    <script type="text/javascript" src="javascript/comets.js"></script>
</head>
<body>
    <header>
        <a href="./index.html" target="_BLANK"><img src="public/images/COMETSLogo.png" alt="COMETS Analytics" title="Banner of COMETS Analytics" /></a>
    </header>
    <div class="container-fluid">
        <div id="pageContent">
            <div id="header" class="container-fluid">
                <div class="row">
                    <div id='page-head' class="col-xs-12">
                        <strong>CO</strong>nsortium of <strong>MET</strong>abolomics <strong>S</strong>tudies
                        <span class="pull-right"><span></span><a id="logoutBtn" href="">Logout</a></span>
                    </div>
                </div>
                <div class="row">
                    <nav class="navbar navbar-default">
                        <div id="comets-tab-nav">
                            <ul class="nav nav-pills">
                                <li role="presentation" class="active"><a data-toggle="tab" data-target="#tab-home">Home</a></li>
                                <li role="presentation"><a data-toggle="tab" data-target="#tab-combine">Create Input</a></li>
                                <li role="presentation"><a data-toggle="tab" data-target="#tab-correlate">Correlate</a></li>
                                <li role="presentation"><a data-toggle="tab" data-target="#tab-help">Help</a></li>
                                <li id="adminBtn" role="presentation" class="pull-right"><a href="admin/index.html">Admin</a></li>
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
            <div class="tab-content">
                <div class="tab-pane active" id="tab-home">
                    <div class="container">
                        <div class="row">
                            <h3><strong>Welcome to COMETS Analytics!</strong></h3>
                            <p>This web-based self-service application supports all individual cohort analyses of the COMETS consortium to produce aggregated data for meta-analyses. This collaborative work is done via the COMETS harmonization group to enable consistent and reproducible analyses across studies.  Specifically, the platform: 1)  harmonizes metabolite names; 2) performs statistical analyses of metabolomics data; and 3) outputs analysis results in a standardized format ready for meta-analysis. Data are not saved in the system, but output must be downloaded and submitted centrally for meta-analyses. Each type of analyses will be available in the navigation bar.  At present, only correlation analyses are available (see <a href="#tab-correlate" class="clicktab">Correlate tab</a>).  For details, see the <a href="#tab-help" class="clicktab">Help tab</a>.</p>
                            <p>For more information on the consortium, see <a href=" http://epi.grants.cancer.gov/comets/" target="_blank">COMETS website</a>.</p>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="tab-combine">
                    <div class="row">
                        <div class="col-xs-12 col-md-4 col-lg-3">
                            <form id="combineForm"class="well clearfix">
                                <fieldset class="well">
                                    <div class="form-group">
                                        <label for="template">Select Template <span class="required">*</span></label>
                                        <div class="row">
                                            <div class="col-xs-12">
                                                <select name="templateSelection" id="templateSelection" class="form-control col-xs-12" required>
                                                    <option value=""> -- Select Template -- </option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                                <fieldset class="well">
                                    <div class="form-group">
                                        <label for="metadata">Select Metabolite Meta-Data CSV File <span class="required">*</span></label>
                                        <input type="file" name="metadata" accept=".csv,text/csv"/>
                                    </div>
                                    <div class="form-group">
                                        <label for="abundances">Select Metabolite Abundances CSV File <span class="required">*</span></label>
                                        <input type="file" name="abundances" accept=".csv,text/csv"/>
                                    </div>
                                    <div class="form-group">
                                        <label for="sample">Select Sample Meta-Data CSV File <span class="required">*</span></label>
                                        <input type="file" name="sample" accept=".csv,text/csv"/>
                                    </div>
                                </fieldset>
                                <fieldset class="well">
                                </fieldset>
                            </form>
                            <div class="pull-right">
                                <button id="resetCombine" class="btn btn-default">Reset</button>
                                <button id="combineFiles" class="btn btn-default" disabled="true">Combine</button>
                            </div>
                            <div id="combineDownload" class="downloadIcon">
                                <a href=""><span class="glyphicon glyphicon-download"></span> Download Combined File</a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- start correlate Tab -->
                <div class="tab-pane" id="tab-correlate">
                    <div class="row">
                        <div class="col-xs-12 col-md-4 col-lg-3">
                            <h3>Conduct cohort-specific correlation analyses</h3>
                            <form id="cometsForm" class="well clearfix" name="cometsForm" enctype="multipart/form-data">
                                <fieldset class="well">
                                    <div class="row">
                                        <div id="messageDiv"></div>
                                    </div>
                                    <div class="form-group">
                                        <label for="cohortSelection">Specify Cohort <span class="required">*</span></label>
                                        <div class="row">
                                            <div class="col-xs-12">
                                                <select name="cohortSelection" id="cohortSelection" class="form-control col-xs-12" required>
                                                    <option value=""> -- Select Cohort -- </option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputDataFile">Choose Input Data File <span class="required">*</span></label>
                                        <div class="row">
                                            <input type="file" id="inputDataFile" name="inputDataFile" accept=".xls,.xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel" class="col-xs-12 col-sm-7" required>
                                            <div class="col-xs-12 col-sm-5">
                                                <button id="load" class="btn btn-default pull-right" disabled="true">Check Integrity</button>
                                            </div>
                                        </div>
                                        <div id="calcProgressbar" class="progress">
                                            <div class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                                                Uploading....please wait
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                                <fieldset id="analysisOptions" class="well">
                                    <b>Specify Method Of Analyses</b>
                                    <div class="radio">
                                        <label for="methodSelection1">
                                            <input type="radio" name="methodSelection" id="methodSelection1" value="Batch" checked="checked">Batch as specfied in the input file
                                        </label>
                                    </div>
                                    <div class="radio">
                                        <label for="methodSelection2">
                                            <input type="radio" name="methodSelection" id="methodSelection2" value="Interactive">Interactive user input
                                        </label>
                                    </div>
                                    <div id="Batch">
                                        <div class="form-group">
                                            <label for="modelSelection">Choose Model <span class="required">*</span></label>
                                            <select name="modelSelection" id="modelSelection" class="form-control" required></select>
                                        </div>
                                    </div>
                                    <div id="Interactive">
                                        <div class="form-group">
                                            <label for="modelDescription">Describe Model <span class="required">*</span></label>
                                            <input type="text" name="modelDescription" id="modelDescription" class="form-control" required />
                                        </div>
                                        <div class="form-group checkbox">
                                            <label for="showMetabolites">
                                                <input type="checkbox" name="showMetabolites" id="showMetabolites">Show individual metabolites
                                                <br>
                                                <em><small>* Note: This option applies to Exposures, Outcomes and Adjusted Covariates</small></em>
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label for="exposure">Select Exposure(s) <span class="required">*</span></label>
                                            <input type="text" name="exposure" id="exposure" required />
                                        </div>
                                        <div class="form-group">
                                            <label for="outcome">Select Outcome(s) <span class="required">*</span></label>
                                            <input type="text" name="outcome" id="outcome" required />
                                        </div>
                                        <div class="form-group">
                                            <label for="covariates">Adjusted Covariates:</label>
                                            <input type="text" name="covariates" id="covariates" />
                                        </div>
                                    </div>
                                </fieldset>
                                <div class="pull-right">
                                    <button id="reset" class="btn btn-default">Reset</button>
                                    <button id="runModel" class="btn btn-default" disabled="true">Run Model</button>
                                </div>
                                <div id="HelpIcon" style="margin-bottom:8px">
                                    <i class="glyphicon glyphicon-question-sign" style="color:#337Ab7"></i><a id="toggleHelp" href="javascript:void(0);"> Help</a>
                                </div>                                
                                <div class="downloadIcon">
                                    <a id="sampleDownload" href="examples/cometsInput.xlsx"><span class="glyphicon glyphicon-download"></span> Download Sample Input</a>
                                </div>
                                <div class="downloadIcon">
                                    <a id="harmonizeDownload" href="examples/uid.xls"><span class="glyphicon glyphicon-download"></span> Download Master Metabolite List</a>
                                </div>
                                <div id="inputHelp">
                                    <h4>Input fields</h4> Specify the name of your cohort. If your cohort is not listed, please notify the harmonization group.

                                    <h4>Integrity check</h4> The tab will display the results of the harmonization and integrity check results.

                                    <h4>Summary</h4> The table of correlations and metabolite information is displayed with an option to download the results in CSV format. For each exposure, the correlation, n and p value are displayed. Please download the file for each model and send to data harmonization group.


                                    <h4>Heatmap</h4> The heatmap displays the metabolites in rows and exposures in columns using partial (if adjustment variables are specified) spearman correlations. From this tab, you can download the heatmap as a png file, pan, zoom and get correlation coefficients. You can also sort the results using the dropdown menu.

                                    <h4>Cluster and heatmap</h4> The cluster and heatmap is available for use when there are 2 or more exposures and 2 or more outcomes are specified.


                                    <!-- on hold <h4>Network</h4> Using the genenet package, we display the partial correlation network of your outcomes, exposures and adjusted covariates. There is an option to display the minimum correlation to display with a default of 0.40. -->

                                </div>
                            </form>
                        </div>
                        <!-- end of well -->

                        <div class="col-xs-12 col-md-8 col-lg-9">
                            <div class="row">
                                <div class="col-md-12">
                                    <!-- Collect the nav links, forms, and other content for toggling -->
                                    <ul class="nav nav-tabs responsive">
                                        <li class="active"><a href="#tab-integrity" data-toggle="tab">Integrity Check</a></li>
                                        <li><a href="#tab-summary" data-toggle="tab">Correlation Results</a></li>
                                        <li><a href="#tab-heatmap" data-toggle="tab">Heatmap</a></li>
                                    </ul>
                                    <div id="result-tab-content" class="tab-content tab-border">
                                        <div class="tab-pane active" id="tab-integrity"></div>
                                        <div class="tab-pane" id="tab-summary"></div>
                                        <div class="tab-pane" id="tab-heatmap"></div>
                                    </div>
                                </div>
                            </div>
                            <!-- end of row -->
                        </div>
                    </div>
                    <!-- end of right panel -->
                </div>
                <!-- start help Tab -->
                <div class="tab-pane" id="tab-help">
                    <div id="toc">
                        <div><a href="#about" class="goto">About</a></div>
                        <div><a href="#support" class="goto">Support</a></div>
                        <div><a href="#flowchart" class="goto">Analytic Flow</a></div>
                    </div>
                    <div id="help-content">
                        <div id="about">
                            <h2>About</h2>
                            <p>COMETS Analytics was developed by the COMETS Data Harmonization Group with web interface support from NCI's <a href="http://cbiit.nci.nih.gov/" target="_blank">CBIIT</a>. Metabolite names were harmonized by linking metabolite lists of frequently-used metabolomics platforms to unique identifiers from public metabolite databases (e.g. HMDB, REFMET).  Prototypes of the web platform were developed using R Shiny. The underlying statistical analyses and data processing uses an R package called COMETS which can be run locally. The HTML5-based web interface to the COMETS package is currently hosted on Amazon Cloud to provides scalability for computationally-intensive analyses.  COMETS analytics was designed so that users can submit data in standard Excel format using the template described below where one can also specify models through the Excel file or through a web-interface.  The app currently performs Spearman correlations, with interactive graphics provided by Plotly.</p>
                            <p>We thank Krista Zanetti for her support and the CBIIT team who translated the R Shiny prototype to HTML5 with funding support from the DCEG Informatics Challenge: Sue Pan, JJ Pan, Kai-Ling Chen, Tony Hall, and Wesley Obenshain.</p>
                            <p>COMETS Package Development Team: <a href="mailto:ella@bsc.gwu.edu">Ella Temprosa</a>, <a href="mailto:Ewy.Mathe@osumc.edu">Ewy Mathe</a>, <a href="mailto:moorest@mail.nih.gov">Steve Moore</a>, and <a href="mailto:RischA@imsweb.com">Adam Risch</a></p>
                        </div>
                        <div id="support">
                            <h2>Support</h2>
                            <p>For questions or help on COMETS Analytics, please send email to <a href="mailto:comets.analytics@gmail.com">comets.analytics@gmail.com</a></p>
                            <p>For help on metabolite harmonization, contact <a href="mailto:RischA@imsweb.com">Adam Risch</a>.</p>
                        </div>
                        <div id="flowchart">
                            <div class="row">
                                <h2 class="col-xs-12">Analytic Flow</h2>
                            </div>
                            <div class="row">
                                <div class="col-xs-12">
                                    <span>Steps in the COMETS analysis process are outlined below.</span>
                                    <img class="img-repsonsive" src="public/images/cometsWorkflow.png" alt="diagram of the workflow for the comets application" width="800" />
                                </div>
                            </div>
                            <div class="row">
                                <h3 class="col-xs-12 col-md-2"><div class="steps">Step 1</div></h3>
                                <div class="col-xs-12 col-md-10">
                                    <h3>Upload input file</h3>
                                    <p>The input file is currently in excel formate with 5 sheets. Download and use the <a href="examples/cometsInput.xlsx" title="example input excel file">example input file here</a> as a template.</p>
                                    <ol>
                                        <li> <b><i>Metabolites</i></b>
                                            <br>This sheet serves as the metadata or information on the metabolites used for the harmonization step. Minimum required columns include analysis platform, metabolite name and metabolite id (ie. variable name of your metabolite). It is preferred to also include RT, m/z, chemical ID (HMDB, InChi key, or other identifier).
                                        </li>
                                        <li> <b><i>SubjectMetabolites</i></b>
                                            <br> This sheet contains the abundances in columns and subject in rows. The subject identifier is expected in the first column and the remaining columns are considered as metabolite ids.
                                        </li>
                                        <li> <b><i>SubjectData</i></b>
                                            <br> This sheet contains other exposure and adjustment variables for use in the analyses.
                                        </li>
                                        <li> <b><i>VarMap</i></b>
                                            <br>This sheet is used to map the variables needed to conduct the cohort specific analysis. Specify the name of variables under CohortVariable column and add notes for your convenience. Cells in grey are protected. You will also need to specify the column name in the metabolites sheet corresponding to your metabolite_id.
                                        </li>
                                        <li> <b><i>Models</i></b>
                                            <br> This sheet is used for the batch analyses mode and contains the model specifications. Outcomes, exposures and adjustment can specify multiple covariates delimited by spaces (ie: age bmi).
                                        </li>
                                    </ol>
                                </div>
                            </div>
                            <div class="row">
                                <h3 class="col-xs-12 col-md-2"><div class="steps">Step 2</div></h3>
                                <div class="col-xs-12 col-md-10">
                                    <h3>Harmonize Metabolites</h3>
                                    <p>
                                        The harmonization step will assess whether your cohort’s metabolites are available in COMET’s master metabolites so that a universal ID (named UID_01) can be associated with your metabolites. The COMETS master metabolite list is maintained by IMS and can be sent in advance of the analyses to ensure availability of a universal ID for each of your metabolites. The universal ID (currently named UID_01) ensures alignment of metabolites across the different cohorts to ensure identification for meta-analysis.</p>
                                </div>
                            </div>
                            <div class="row">
                                <h3 class="col-xs-12 col-md-2"><div class="steps">Step 3</div></h3>
                                <div class="col-xs-12 col-md-10">
                                    <h3>Data Integrity</h3>
                                    <p>
                                        Data integrity checks are run to ensure the appropriate data are presented for analyses. The following conditions are checked:
                                        <ol>
                                            <li> Subject ID or Metabolite ID is/are not provided in the Varmap sheet
                                            </li>
                                            <li> Subject ID or Metabolite ID provided in Varmap sheet do not correspond to a column in “Metabolites” and “SubjectData” sheets, respectively
                                            </li>
                                            <li> Metabolites ids in Metabolites and SubjectMetabolites sheet do not match
                                            </li>
                                            <li> Subject ids in SubjectData and SubjectMetabolites sheet do not match
                                            </li>
                                        </ol>
                                        If any of the following conditions failed, the analyses will be suspended and corrections to the data are required. The data integrity checks will also flag the following but will proceed with the analyses:
                                        <ol>
                                            <li> Number of subjects in “SubjectData” and “SubjectMetabolites” sheets do not match
                                            </li>
                                            <li> Metabolite abundances from “SubjectMetabolites” contains duplicate columns (metabolites) or rows (subjects)
                                            </li>
                                            <li> There are duplicate subject ids in Subject Information “SubjectData” sheet
                                            </li>
                                            <li> There are duplicate metabolite ids in Metabolite Information “Metabolites” sheet
                                            </li>
                                        </ol>
                                    </p>
                                </div>
                            </div>
                            <div class="row">
                                <h3 class="col-xs-12 col-md-2"><div class="steps">Step 4</div></h3>
                                <div class="col-xs-12 col-md-10">
                                    <h3>Run Correlation Analyses</h3>
                                    <p>
                                        The correlation analyses can be done in batch (as specified in the input file) or in interactive mode using user specified exposure and outcome variables. Heatmaps and hierarchical clustering of the computed Spearman correlations are also available.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- end of help tab content -->
            </div>
            <!-- end of correlate Tab -->
        </div>
        <div id="loader"><img src="public/images/loader.gif" alt="Loading....Please Wait"></div>
    </div>
</body>

</html>
